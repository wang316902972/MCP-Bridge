services:
  mcp-bridge:
    build:
      context: .
    develop:
      watch:
        - path: mcp_bridge
          action: rebuild
    container_name: mcp-bridge
    ports:
      - "8004:8000"
    networks:
      - default
      - docker_graphiti-mcp-network
      - serena_serena-mcp-network
    environment:
      - MCP_BRIDGE__CONFIG__FILE=config.json
      # Use proxy for external access but bypass for internal networks
      - http_proxy=http://192.168.136.223:7897
      - https_proxy=http://192.168.136.223:7897
      - HTTP_PROXY=http://192.168.136.223:7897
      - HTTPS_PROXY=http://192.168.136.223:7897
      - NO_PROXY=localhost,127.0.0.1,192.168.136.224,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12
      - no_proxy=localhost,127.0.0.1,192.168.136.224,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12
    volumes:
      # 映射配置文件
      - ./config.json:/mcp_bridge/config.json:ro
      # 映射源码目录到容器，实现代码热更新
      - ./mcp_bridge:/mcp_bridge/mcp_bridge:rw
      # 可选：日志目录映射
      # - ./logs:/mcp_bridge/logs:rw
    restart: unless-stopped

  jaeger:
    image: jaegertracing/jaeger:latest
    ports:
      - "16686:16686"   # Web UI
      # - "4317:4317"     # OTLP gRPC
      - "4318:4318"     # OTLP HTTP
      # - "5778:5778"     # Config server
      # - "9411:9411"     # Zipkin compatible
    restart: unless-stopped

networks:
  docker_graphiti-mcp-network:
    external: true
    name: docker_graphiti-mcp-network
  serena_serena-mcp-network:
    external: true
    name: serena_serena-mcp-network
